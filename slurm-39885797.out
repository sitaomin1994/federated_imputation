Executing command: python main_experiment_amarel.py config_vars/imp_extention2=vehicle_exp23.yaml
2024-11-18 15:27:02.637 | INFO     | src.experiment_management.experiment_manager:set_experiment:22 - Experiment name: fed_imp
2024-11-18 15:27:02.642 | INFO     | src.experiment_management.experiment_manager:run_experiments:45 - Running 1 experiments
2024-11-18 15:27:02.642 | INFO     | src.experiment_management.experiment_manager:run_experiments:51 - Experiment - 0
2024-11-18 15:27:02.642 | INFO     | src.experiment_management.experiment_manager:run_experiments:52 - Experiment - ['dn', 'nc', 'dp', 'ms', 'mct', 'st', 'as', 's', 's', 'p', 'nr', 'n', 'ts']
2024-11-18 15:27:02.643 | INFO     | src.experiment_management.experiment_manager:run_experiments:53 - Experiment - ('vehicle', 0, 'natural', 'random2@mrl=0.3_mrr=0.7_mm=mnarlrsigst', 'allk0.25_sphere', 'fedavg_pytorch', 'fedmech_w', 102931466, 50, False, 10, 10, 0.1)
config_tmpl:
  num_clients: 10
  data:
    dataset_name: breast
    normalize: true
  data_partition:
    strategy: full
    params: {}
  handle_imbalance: null
  missing_simulate:
    mf_strategy: all
    mm_strategy: none
    mm_strategy_params:
      corr_type: others
  imputation:
    initial_strategy_num: mean
    initial_strategy_cat: mode
    estimator_num: ridge_cv
    estimator_cat: logistic_cv
    imp_evaluation_model: logistic
    imp_evaluation_params:
      tune_params: gridsearch
    clip: true
  agg_strategy_imp:
    strategy: local
    params:
      ms_field: missing_cell_pct
      beta: 0.7
  client_type: ice
  server_type: fedavg_pytorch
  server:
    impute_mode: instant
    imp_round: 20
    imp_local_epochs: 0
    pred_round: 0
    pred_local_epochs: 0
    model_fit_mode: one_shot
    froze_ms_coefs_round: 100
  pred_model:
    model_params:
      model: 2nn
      num_hiddens: 32
      model_init_config: null
      model_other_params: null
    train_params:
      batch_size: 128
      learning_rate: 0.001
      weight_decay: 0.0001
      pred_round: 200
      pred_local_epochs: 3
  experiment:
    n_rounds: 5
    seed: 102931466
    mtp: true
    random_seed: 50
    num_process: 5
    test_size: 0.1
  track: false
  tune_params: false
  prediction: false
  save_state: true
  algo_params:
    central: {}
    central2: {}
    central_vae: {}
    central_gain: {}
    local: {}
    local_vae: {}
    local_gain: {}
    fedavg: {}
    fedavg_vae: {}
    fedavg_gain: {}
    fedwavg:
      alpha: 0.9
    fedmechw:
      client_thres: 1.0
      alpha: 1.0
      beta: 0.0,
      scale_factor: 4
    fedmechw_p:
      client_thres: 1.0
      alpha: 0.85
      beta: 0.1
      scale_factor: 4
    fedmechw_new:
      client_thres: 1.0
      alpha: 0.95
      gamma: 0.02
      scale_factor: 4
    fedmechw_dedup:
      client_thres: 1.0
      alpha: 0.95
      gamma: 0.02
      scale_factor: 4
    fedmechw_p_sigmoid:
      client_thres: 1.0
      alpha: 0.9
      beta: 0.1
      scale_factor: 3
    fedmechclw:
      client_thres: 1.0
      thres1: 0.2
      alpha: 0.8
    scale_factor: 6
config_vars:
  vehicle_exp21:
  - name: dataset_name
    value:
    - vehicle
    keys:
    - data
    - dataset_name
    save_mode: dir1
  - name: n_client
    value:
    - 0
    save_mode: dir2
    keys:
    - num_clients
  - name: data_partition
    value:
    - natural
    save_mode: dir3
    keys:
    - data_partition
    - strategy
  - name: mm_strategy
    value:
    - random2@mrl=0.3_mrr=0.7_mm=mnarlrsigst
    save_mode: dir4
    keys:
    - missing_simulate
    - mm_strategy_new
  - name: mm_corr_type
    value:
    - allk0.25_sphere
    save_mode: dir4
    keys:
    - missing_simulate
    - mm_strategy_params
    - corr_type
  - name: server_type
    value:
    - fedavg_pytorch
    save_mode: none
    keys:
    - server_type
  - name: agg_strategy
    value:
    - fedmech_w
    save_mode: null
    keys:
    - agg_strategy_imp
    - strategy
  - name: seed
    value:
    - 102931466
    save_mode: null
    keys:
    - experiment
    - seed
  - name: seed2
    value:
    - 50
    save_mode: null
    keys:
    - experiment
    - random_seed
  - name: params
    value:
    - false
    save_mode: null
    keys:
    - tune_params
  - name: n_rounds
    value:
    - 10
    save_mode: none
    keys:
    - experiment
    - n_rounds
  - name: np
    value:
    - 10
    save_mode: none
    keys:
    - experiment
    - num_process
  - name: test_size
    value:
    - 0.1
    save_mode: none
    keys:
    - experiment
    - test_size
experiment_name: fed_imp_ext2_amarel
debug: false
experiment_marker:
- num_clients
- server@imp_round

========================================================================================================================================================================================================
{'num_clients': 0, 'data': {'dataset_name': 'vehicle', 'normalize': True}, 'data_partition': {'strategy': 'natural', 'params': {}}, 'handle_imbalance': None, 'missing_simulate': {'mf_strategy': 'all', 'mm_strategy': 'none', 'mm_strategy_params': {'corr_type': 'allk0.25_sphere'}, 'mm_strategy_new': 'random2@mrl=0.3_mrr=0.7_mm=mnarlrsigst'}, 'imputation': {'initial_strategy_num': 'mean', 'initial_strategy_cat': 'mode', 'estimator_num': 'ridge_cv', 'estimator_cat': 'logistic_cv', 'imp_evaluation_model': 'logistic', 'imp_evaluation_params': {'tune_params': 'gridsearch'}, 'clip': True}, 'agg_strategy_imp': {'strategy': 'fedmech_w', 'params': {'ms_field': 'missing_cell_pct', 'beta': 0.7}}, 'client_type': 'ice', 'server_type': 'fedavg_pytorch', 'server': {'impute_mode': 'instant', 'imp_round': 20, 'imp_local_epochs': 0, 'pred_round': 0, 'pred_local_epochs': 0, 'model_fit_mode': 'one_shot', 'froze_ms_coefs_round': 100}, 'pred_model': {'model_params': {'model': '2nn', 'num_hiddens': 32, 'model_init_config': None, 'model_other_params': None}, 'train_params': {'batch_size': 128, 'learning_rate': 0.001, 'weight_decay': 0.0001, 'pred_round': 200, 'pred_local_epochs': 3}}, 'experiment': {'n_rounds': 10, 'seed': 102931466, 'mtp': True, 'random_seed': 50, 'num_process': 10, 'test_size': 0.1}, 'track': False, 'tune_params': False, 'prediction': False, 'save_state': True, 'algo_params': {'central': {}, 'central2': {}, 'central_vae': {}, 'central_gain': {}, 'local': {}, 'local_vae': {}, 'local_gain': {}, 'fedavg': {}, 'fedavg_vae': {}, 'fedavg_gain': {}, 'fedwavg': {'alpha': 0.9}, 'fedmechw': {'client_thres': 1.0, 'alpha': 1.0, 'beta': '0.0,', 'scale_factor': 4}, 'fedmechw_p': {'client_thres': 1.0, 'alpha': 0.85, 'beta': 0.1, 'scale_factor': 4}, 'fedmechw_new': {'client_thres': 1.0, 'alpha': 0.95, 'gamma': 0.02, 'scale_factor': 4}, 'fedmechw_dedup': {'client_thres': 1.0, 'alpha': 0.95, 'gamma': 0.02, 'scale_factor': 4}, 'fedmechw_p_sigmoid': {'client_thres': 1.0, 'alpha': 0.9, 'beta': 0.1, 'scale_factor': 3}, 'fedmechclw': {'client_thres': 1.0, 'thres1': 0.2, 'alpha': 0.8}, 'scale_factor': 6}}
[(2578, 24), (1511, 24), (1519, 24), (1425, 24), (1375, 24), (1164, 24), (1683, 24), (1735, 24), (2000, 24), (1701, 24), (1803, 24), (1803, 24), (1954, 24), (2200, 24), (2214, 24), (1914, 24), (2068, 24), (1962, 24), (2287, 24), (2002, 24), (2068, 24), (2448, 24), (2281, 24)]
(2320, 24)
(1359, 24)
(1367, 24)
(1282, 24)
(1237, 24)
(1047, 24)
(1514, 24)
(1561, 24)
(1800, 24)
(1530, 24)
(1622, 24)
(1622, 24)
(1758, 24)
(1980, 24)
(1992, 24)
(1722, 24)
(1861, 24)
(1765, 24)
(2058, 24)
(1801, 24)
(1861, 24)
(2203, 24)
(2052, 24)
2024-11-18 15:27:03.887 | INFO     | src.fed_imp.experiment:main_func:31 - Round 0
2024-11-18 15:27:03.924 | INFO     | src.fed_imp.experiment:main_func:31 - Round 1
2024-11-18 15:27:03.976 | INFO     | src.fed_imp.experiment:main_func:31 - Round 2
2024-11-18 15:27:04.021 | INFO     | src.fed_imp.experiment:main_func:31 - Round 3
2024-11-18 15:27:04.157 | INFO     | src.fed_imp.experiment:main_func:31 - Round 4
2024-11-18 15:27:04.217 | INFO     | src.fed_imp.experiment:main_func:31 - Round 5
2024-11-18 15:27:04.330 | INFO     | src.fed_imp.experiment:main_func:31 - Round 6
2024-11-18 15:27:04.430 | INFO     | src.fed_imp.experiment:main_func:31 - Round 7
2024-11-18 15:27:04.540 | INFO     | src.fed_imp.experiment:main_func:31 - Round 8
2024-11-18 15:27:04.656 | INFO     | src.fed_imp.experiment:main_func:31 - Round 9
natural {}
Adding missing to client 0 ...
Adding missing to client 1 ...
Adding missing to client 2 ...
Adding missing to client 3 ...
Adding missing to client 4 ...
Adding missing to client 5 ...
Adding missing to client 6 ...
Adding missing to client 7 ...
Adding missing to client 8 ...
Adding missing to client 9 ...
Adding missing to client 10 ...
Adding missing to client 11 ...
Adding missing to client 12 ...
Adding missing to client 13 ...
Adding missing to client 14 ...
Adding missing to client 15 ...
Adding missing to client 16 ...
Adding missing to client 17 ...
Adding missing to client 18 ...
Adding missing to client 19 ...
Adding missing to client 20 ...
Adding missing to client 21 ...
Adding missing to client 22 ...
client: 0 dup rate: 0.0
client: 1 dup rate: 0.0
client: 2 dup rate: 0.0
client: 3 dup rate: 0.0
client: 4 dup rate: 0.0
client: 5 dup rate: 0.030563514804202496
client: 6 dup rate: 0.0
client: 7 dup rate: 0.0
client: 8 dup rate: 0.0
client: 9 dup rate: 0.0
client: 10 dup rate: 0.0
client: 11 dup rate: 0.0
client: 12 dup rate: 0.0
client: 13 dup rate: 0.0
client: 14 dup rate: 0.0
client: 15 dup rate: 0.0
client: 16 dup rate: 0.0
client: 17 dup rate: 0.0
client: 18 dup rate: 0.0
client: 19 dup rate: 0.0
client: 20 dup rate: 0.0
client: 21 dup rate: 0.0
client: 22 dup rate: 0.0
natural {}
Adding missing to client 0 ...
Adding missing to client 1 ...
Adding missing to client 2 ...
Adding missing to client 3 ...
Adding missing to client 4 ...
Adding missing to client 5 ...
Adding missing to client 6 ...
Adding missing to client 7 ...
Adding missing to client 8 ...
Adding missing to client 9 ...
Adding missing to client 10 ...
Adding missing to client 11 ...
Adding missing to client 12 ...
Adding missing to client 13 ...
Adding missing to client 14 ...
Adding missing to client 15 ...
Adding missing to client 16 ...
Adding missing to client 17 ...
Adding missing to client 18 ...
Adding missing to client 19 ...
Adding missing to client 20 ...
Adding missing to client 21 ...
Adding missing to client 22 ...
client: 0 dup rate: 0.0
client: 1 dup rate: 0.0
client: 2 dup rate: 0.0
client: 3 dup rate: 0.0
client: 4 dup rate: 0.0
client: 5 dup rate: 0.030563514804202496
client: 6 dup rate: 0.0
client: 7 dup rate: 0.0
client: 8 dup rate: 0.0
client: 9 dup rate: 0.0
client: 10 dup rate: 0.0
client: 11 dup rate: 0.0
client: 12 dup rate: 0.0
client: 13 dup rate: 0.0
client: 14 dup rate: 0.0
client: 15 dup rate: 0.0
client: 16 dup rate: 0.0
client: 17 dup rate: 0.0
client: 18 dup rate: 0.0
client: 19 dup rate: 0.0
client: 20 dup rate: 0.0
client: 21 dup rate: 0.0
client: 22 dup rate: 0.0
natural {}
Adding missing to client 0 ...
Adding missing to client 1 ...
Adding missing to client 2 ...
Adding missing to client 3 ...
Adding missing to client 4 ...
Adding missing to client 5 ...
Adding missing to client 6 ...
Adding missing to client 7 ...
Adding missing to client 8 ...
Adding missing to client 9 ...
Adding missing to client 10 ...
Adding missing to client 11 ...
Adding missing to client 12 ...
Adding missing to client 13 ...
Adding missing to client 14 ...
Adding missing to client 15 ...
Adding missing to client 16 ...
Adding missing to client 17 ...
Adding missing to client 18 ...
Adding missing to client 19 ...
Adding missing to client 20 ...
Adding missing to client 21 ...
Adding missing to client 22 ...
client: 0 dup rate: 0.0
client: 1 dup rate: 0.0
client: 2 dup rate: 0.0
client: 3 dup rate: 0.0
client: 4 dup rate: 0.0
client: 5 dup rate: 0.030563514804202496
client: 6 dup rate: 0.0
client: 7 dup rate: 0.0
client: 8 dup rate: 0.0
client: 9 dup rate: 0.0
client: 10 dup rate: 0.0
client: 11 dup rate: 0.0
client: 12 dup rate: 0.0
client: 13 dup rate: 0.0
client: 14 dup rate: 0.0
client: 15 dup rate: 0.0
client: 16 dup rate: 0.0
client: 17 dup rate: 0.0
client: 18 dup rate: 0.0
client: 19 dup rate: 0.0
client: 20 dup rate: 0.0
client: 21 dup rate: 0.0
client: 22 dup rate: 0.0
natural {}
Adding missing to client 0 ...
Adding missing to client 1 ...
Adding missing to client 2 ...
Adding missing to client 3 ...
Adding missing to client 4 ...
Adding missing to client 5 ...
Adding missing to client 6 ...
Adding missing to client 7 ...
Adding missing to client 8 ...
Adding missing to client 9 ...
Adding missing to client 10 ...
Adding missing to client 11 ...
Adding missing to client 12 ...
Adding missing to client 13 ...
Adding missing to client 14 ...
Adding missing to client 15 ...
Adding missing to client 16 ...
Adding missing to client 17 ...
Adding missing to client 18 ...
Adding missing to client 19 ...
Adding missing to client 20 ...
Adding missing to client 21 ...
Adding missing to client 22 ...
client: 0 dup rate: 0.0
client: 1 dup rate: 0.0
client: 2 dup rate: 0.0
client: 3 dup rate: 0.0
client: 4 dup rate: 0.0
client: 5 dup rate: 0.030563514804202496
client: 6 dup rate: 0.0
client: 7 dup rate: 0.0
client: 8 dup rate: 0.0
client: 9 dup rate: 0.0
client: 10 dup rate: 0.0
client: 11 dup rate: 0.0
client: 12 dup rate: 0.0
client: 13 dup rate: 0.0
client: 14 dup rate: 0.0
client: 15 dup rate: 0.0
client: 16 dup rate: 0.0
client: 17 dup rate: 0.0
client: 18 dup rate: 0.0
client: 19 dup rate: 0.0
client: 20 dup rate: 0.0
client: 21 dup rate: 0.0
client: 22 dup rate: 0.0
Error executing job with overrides: ['config_vars/imp_extention2=vehicle_exp23.yaml']
multiprocessing.pool.RemoteTraceback: 
"""
Traceback (most recent call last):
  File "/cache/home/sm2370/Research/federated_imputation/src/fed_imp/experiment.py", line 87, in main_func
    params = configuration['algo_params'][strategy_name]
             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
KeyError: 'fedmech_w'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/sm2370/.conda/envs/impute4fair/lib/python3.11/multiprocessing/pool.py", line 125, in worker
    result = (True, func(*args, **kwds))
                    ^^^^^^^^^^^^^^^^^^^
  File "/home/sm2370/.conda/envs/impute4fair/lib/python3.11/multiprocessing/pool.py", line 51, in starmapstar
    return list(itertools.starmap(args[0], args[1]))
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/cache/home/sm2370/Research/federated_imputation/src/fed_imp/experiment.py", line 90, in main_func
    raise ValueError("No params")
ValueError: No params
"""

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/cache/home/sm2370/Research/federated_imputation/main_experiment_amarel.py", line 37, in main
    experiment_manager.run_experiments(configs, exp_meta, use_db=False, debug=debug)
  File "/cache/home/sm2370/Research/federated_imputation/src/experiment_management/experiment_manager.py", line 63, in run_experiments
    ret,_ = experiment.run_experiment(exp_config.config)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/cache/home/sm2370/Research/federated_imputation/src/fed_imp/experiment.py", line 299, in run_experiment
    process_results = pool.starmap(main_func, process_args, chunksize=chunk_size)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/sm2370/.conda/envs/impute4fair/lib/python3.11/multiprocessing/pool.py", line 375, in starmap
    return self._map_async(func, iterable, starmapstar, chunksize).get()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/sm2370/.conda/envs/impute4fair/lib/python3.11/multiprocessing/pool.py", line 774, in get
    raise self._value
ValueError: No params

Set the environment variable HYDRA_FULL_ERROR=1 for a complete stack trace.
srun: error: hal0315: task 0: Exited with exit code 1
